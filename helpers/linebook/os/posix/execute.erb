Executes a command and checks the output status.  Quotes all non-option args
that aren't already quoted. Accepts a trailing hash which will be transformed
into command line options.
(command, *args)
  if chain?
    rewrite(/\s*(\ncheck_status.*?\n\s*)?\z/) {|match| ' | ' }
  end
--
<%= format_cmd(command, *args) %>

<% check_status %>